<!doctype html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>F7LTD Restaurant Finder</title>
    <style>
      body { font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif; margin: 0; padding: 16px; }
      .card { border: 1px solid #eee; border-radius: 12px; padding: 12px 16px; margin: 8px 0; box-shadow: 0 1px 2px rgba(0,0,0,.04); }
      .row { display: flex; gap: 8px; align-items: center; }
      input, button { padding: 10px; border-radius: 10px; border: 1px solid #ddd; }
      button { cursor: pointer; }
      .muted { color: #666; font-size: 12px; }
      .grid { display: grid; grid-template-columns: 1fr; gap: 8px; }
      @media (min-width: 720px) { .grid { grid-template-columns: 1fr 1fr; } }
      .badges span {background:#f5f5f5;border-radius:999px;padding:2px 8px;margin-right:6px;font-size:12px}
    </style>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  </head>
  <body>
    <div id="root"></div>
    <script>
      const e = React.createElement;
      function App(){
        const qp = new URLSearchParams(location.search);
        const [zip,setZip]=React.useState(qp.get('zip')||'44113');
        const [radius,setRadius]=React.useState(Number(qp.get('radius')||10));
        const [data,setData]=React.useState(null);
        const [loading,setLoading]=React.useState(false);
        const [err,setErr]=React.useState('');

        async function run(){
          setLoading(true); setErr(''); setData(null);
          try{
            const apiBase = qp.get('apiBase') || '/api';
            const key = qp.get('key') || '';
            const url = new URL(apiBase + '/search', location.origin);
            url.searchParams.set('zip', zip);
            url.searchParams.set('radius_miles', String(radius));
            const res = await fetch(url, { headers: { 'x-api-key': key }});
            if(!res.ok){ throw new Error('Request failed: '+res.status); }
            const j = await res.json();
            setData(j);
          }catch(ex){ setErr(ex.message); }
          finally{ setLoading(false); }
        }

        React.useEffect(()=>{ run(); },[]);

        return e('div',{},
          e('h2',{},'F7LTD Restaurant Finder'),
          e('div',{className:'row'},
            e('input',{value:zip,onChange:(ev)=>setZip(ev.target.value),placeholder:'ZIP'}),
            e('input',{type:'number',value:radius,min:1,max:60,onChange:(ev)=>setRadius(Number(ev.target.value))}),
            e('button',{onClick:run}, loading? 'Searching‚Ä¶':'Search')
          ),
          err && e('div',{style:{color:'crimson',marginTop:8}},err),
          data && e('div',{}, e('div',{className:'muted'}, `${data.count} results for ${data.zip} (radius ${data.radius_miles} mi)`),
            e('div',{className:'grid'},
              data.results.map(r=> e('div',{key:r.id,className:'card'},
                e('div',{}, e('strong',{}, r.name)),
                e('div',{className:'muted'}, r.formattedAddress || ''),
                e('div',{className:'badges'},
                  r.phonePrimary && e('span',{}, '‚òé '+r.phonePrimary),
                  r.website && e('span',{}, 'üåê website'),
                  (r.menus && r.menus[0] && r.menus[0].menuUrl) && e('span',{}, 'üìã menu'),
                  r.ratingAvg && e('span',{}, `‚òÖ ${r.ratingAvg} (${r.ratingCount||0})`)
                ),
                e('div',{},
                  r.website && e('a',{href:r.website,target:'_blank',rel:'noopener'},'Visit website'), ' ',
                  (r.menus && r.menus[0] && r.menus[0].menuUrl) && e('a',{href:r.menus[0].menuUrl,target:'_blank',rel:'noopener',style:{marginLeft:8}},'View menu')
                )
              ))
            )
          )
        );
      }
      ReactDOM.createRoot(document.getElementById('root')).render(e(App));
    </script>
  </body>
</html>
